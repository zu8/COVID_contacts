# COVID_contacts
задача из ННГУ по плюсам
Проект VS назван secondary_contacts и включает в себя 3 основных файла  (infected.h, infected.cpp и main.cpp) а так же 2 тестовых файла (input.txt и  input1.txt).

infected.h
Для записи данных из входного файла была создана структура Tgroup, которая включает в себя поле id – код инфицированного, структуру Tdate для хранения даты заражения, list <int> persons – его список контактов за неделю до заражения и list <int> thanksTo – список инфицированных, благодаря которым предыдущий список расширился (если расширился).
Структура Tgroup  содержит конструктор от 2-х параметров типа const string, а так же перегруженные операторы сравнения (==, <, >) для определения самой многочисленной группы. Структуры сравниваются между собой по численности поля persons.
Структура Tdate, являющаяся полем Tgroup, состоит из полей day,month,year служащим для хранения даты заражения, а так же поля daysFromPivot, значение которого вычисляется в конструкторе от параметров. Оно представляет из себя количество дней от даты 01.01.2000г и является “опорой” при сравнении двух дат.
Контейнером для хранения структур выбран list, т.к. он “дешевле” vectorа и ассоциативных контейнеров при добавлении нового элемента, а доступа к произвольному элементу не планировалось. Кроме того, поля persons и thanksTo так же представляют из себя list (исходя из тех же соображений) и не хотелось подключать еще какие-либо лишние библиотеки. Впрочем, в конце я все же подключил vector для разнообразия, хотя можно было обойтись тем же list.
В дальнейшем, частью решения стала сортировка, а она не так эффективна, как у vector и происходит сама по себе, например у multiset. Поэтому выбор list весьма спорен. 
В заголовочном файле содержатся объявления следующих функций:
(1)	list<Tgroup> createGroups(const char* filename); - служит для создания контейнера (list) из файла, имя которого должно быть передано как параметр.
(2)	Tdate getStructTdate(string a);	- Позволяет получить объект даты используя информацию из строки
(3)	void expandGroups(list<Tgroup>& somelist,unsigned int Range); - функция для расширения списка контактов групп вторичными. Параметрами являются сам контейнер, переданный по ссылке, а так же количество дней, учитываемых для подсчета вторичных контактов.
(4)	void AddToList(list<int> &patient, const list<int> donor);   - вспомогательная функция для добавления к концу одного листа другого листа. Была написана быстрее, чем вспомнил про copy с back_inserter, который далее все же применил, но оставил и эту, и дал работу и ей (жалко удалять)
(5)	vector<Tgroup*> findMax(const list<Tgroup> &somelist);	 -  эта функция в изначальном своем варианте возвращала тип Tgroup, но потом я решил, что максимальных групп может быть и несколько. Для этого я решил использовать vector просто для разнообразия (и еще потому что он мне просто нравится). Затем, я решил собирать в вектор не копии групп, а указатели на них для ускорения.
(6)	void writeMaxGroup(list<Tgroup> somelist, const char* filename);  - Заключительная функция  для записи результата в файл, имя которого должно быть вписано в параметр. Так же выводит результат на консоль.


infected.cpp
Файл содержит реализацию функций и конструкторов из одноименного заголовочного файла. 
Некоторые пояснения:

В конструкторе от параметров Tdate вычисляется поле daysFromPivot с учетом високосного года. Если дата заражения будет в високосный год, то интервал между концом февраля и началом марта будет правильным (т.е. на день больше)

В функции (2) используется вычленение символов с определенных позиций строки, поэтому формат даты во входном файле должен быть обязательно  дд.мм.гггг иначе значения будут отобраны некорректно.

Оператор << перегружен для типа Tgroup для удобства вывода. Для отображения даты в том же формате, что и во входном файле проведены некоторые манипуляции с выводом, использующие библиотеку iomanip. Вывод группы контактов происходит по 5 номеров в ряд, после чего ряд начинается с новой строки.

Функция (1) работает следующим образом:
Открывается файловый поток с одновременным указанием файла для чтения.
Файл считывается по словам. Для этого создаются два буфера типа string.
Сначала слово считывается в первый буфер, затем проверяются условия и при выполнении некоторых считывается следующее слово во второй буфер.
Для правильного заполнения структур при считывании из файла создано регулярное выражение, при совпадении содержания одного из буферов с которым становится ясно, что это дата, а предыдущее слово – id инфицированного.
Перед считыванием следующего слова буфер очищается (кроме некоторых условий для буфера2) для защиты от дублирования информации, если в конце файла стоят символы переноса строки.
Считывание заканчивается при достижении конца файла.
Последним этапом является сортировка групп по дате.

 Функция (3) работает следующим образом:
Создаются несколько итераторов для перемещения по элементам list для Tgroup, а так же для list <int> persons.
Итератор передвигается по списку начиная с первого элемента.
При установке итератора на инфицированного будем называть его “активным”
При работе с “активным” инфицированным перебираются все его контакты и сверяются на совпадения со следующими членами контейнера. Поиск совпадений прекращается при выходе из заданной зоны (кол-во дней после заражения)граница определена в виде глобальной переменной interval в функции main. Если совпадение в контактах со следующими в списке инфицированными найдено, то содержимое их контактов копируется во временный буфер tmp. ID таких инфицированных сразу попадает в поле thanksTo “активного”. Содержимое буфера  tmp добавляется к контактам “активного” после окончания прохода по всем его первичным контактам. Если даты инфицированных равны, то контакты расширяются и у того и у другого. Если дата заражения следующего позже, то при работе с ним к нему не добавляются контакты ранее заболевшего. 
Нахождение максимальной группы происходит в функции (5). Функция просто сравнивает все группы в контейнере по размеру поля persons. 
Можно было не учитывать нерасширенные группы, проверяя попутно размер поля thanksTo. Если размер нулевой – не учитываем. Но в примере сделано сравнение среди всех участников контейнера.

Функция (6) производит запись в файл. При определении нескольких групп в файл и в консоль выходят сведения о нескольких группах.

main.cpp
В тестовом файле задается граница в виде глобальной переменной interval для расширения списка контактов.
По порядку вызываются функции создания list чтением из файла, его модификации и записи в файл результата.
В проекте содержится два тестовых файла – input.txt результатом обработки которого является одна расширенная группа и input1.txt с тремя одинаково расширенными группами. 
